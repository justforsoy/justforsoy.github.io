[
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this blog"
  },
  {
    "objectID": "posts/实验统计原理简介/index.html",
    "href": "posts/实验统计原理简介/index.html",
    "title": "实验统计简介",
    "section": "",
    "text": "两个现实中的问题 - 应用新版本发布7天后，新版用户留存率比老版本用户留存率提升10%，是否说明新版本取得了成功？ - 对商品涨价后，单月收入环比上月提升30%，同比去年提升10%，收入增长了么？赚了多少？\n虽然有了数据，我们仍然很难得到判断，因为我们关注的是因果（反事实）。而随机实验可以观测因果，所以要做实验"
  },
  {
    "objectID": "posts/实验统计原理简介/index.html#为什么要做实验",
    "href": "posts/实验统计原理简介/index.html#为什么要做实验",
    "title": "实验统计简介",
    "section": "",
    "text": "两个现实中的问题 - 应用新版本发布7天后，新版用户留存率比老版本用户留存率提升10%，是否说明新版本取得了成功？ - 对商品涨价后，单月收入环比上月提升30%，同比去年提升10%，收入增长了么？赚了多少？\n虽然有了数据，我们仍然很难得到判断，因为我们关注的是因果（反事实）。而随机实验可以观测因果，所以要做实验"
  },
  {
    "objectID": "posts/实验统计原理简介/index.html#实验结果可信么",
    "href": "posts/实验统计原理简介/index.html#实验结果可信么",
    "title": "实验统计简介",
    "section": "实验结果可信么？",
    "text": "实验结果可信么？\n我做了AB实验，实验组平均付费比对照组提升了1.1元，我的实验策略是否是有效的？\n由于现实中充满波动性，这个问题很难直接回答。但如果知道事件随机发生概率是多少，我们至少有一些把握\n以最简单的抛硬币为例：\n\nimport numpy as np\nimport pandas as pd\nfrom scipy import stats\nimport matplotlib.pyplot as plt\n\ndef binom_plot(n, obs, p=0.5):\n    dist = stats.binom(n, p)\n    x = np.arange(0, n+1)\n    pmf = dist.pmf(x)\n\n    thres = np.abs(np.abs(obs) - n/2)\n    plt.bar(x, pmf, color=['red' if np.abs(np.abs(i) - n/2) &gt;= thres else 'blue' for i in range(len(x))], alpha=0.5)\n    plt.show()\n\n\n一枚硬币扔了10次，其中6次正面，硬币是否均匀？\n如果硬币是均匀的，得到这种情况或者更极端情况的概率是多少：\\[P(投10次6次以上某一面 | 硬币均匀)\\]\n\n\nbinom_plot(10, 6)\n\n\n\n\n\n一枚硬币扔了100次，其中60次正面，它是否均匀？\n\\[P(投100次60次以上某一面 | 硬币均匀)\\]\n\n\nbinom_plot(100, 60)\n\n\n\n\n\n一枚硬币扔了1000次，其中600次正面，它是否均匀？\n\\[P(投1000次600次以上某一面 | 硬币均匀)\\]\n\n\nbinom_plot(1000, 600)\n\n\n\n\n实验也可以用类似的方法计算概率。其中最常用的是基于正态分布来计算：\n由于实验样本量一般较大，分组样本一般满足中心极限定律 &gt; 中心极限定律：\n&gt; 当大量随机变量相互独立时，它们的和或平均值的分布接近于正态分布。\n由此可得： \\[\\bar{X}_A \\sim N(E(X_A), \\sigma^2/cnt_A),\\ \\ \\  \\bar{X}_B \\sim N(E(X_B), \\sigma^2 / cnt_B)\\]\n若实验策略无效，实验组与对照组期望效果相同：\\(E(X_A) = E(X_B)\\)\n根据两个正态分母随机变量相减仍然服从正态分布的性质，则此时： \\[\\bar{X}_A - \\bar{X}_B \\sim N(0, \\sigma^2/cnt_A + \\sigma^2/cnt_B)\\]\n因此可以计算：在实验策略无效的情况下，得到这样的数据或者更极端数据的概率是多少？ —— 此概率越低，则实验策略有效概率越大"
  },
  {
    "objectID": "posts/实验统计原理简介/index.html#有了概率后如何决策",
    "href": "posts/实验统计原理简介/index.html#有了概率后如何决策",
    "title": "实验统计简介",
    "section": "有了概率后如何决策？",
    "text": "有了概率后如何决策？\n自然发生概率越低，实验策略有效概率越大。我们应该怎么基于这个数值进行决策？\n真相只有一个，但有两种可能，随之会导致两种决策错误：\n- 假阳性。实验策略无效，被误认为有效，类比于没得新冠检验阳性\n- 假阴性。实验策略有效，被误认为无效，类比于得了新冠检验阴性\n只要控制住这两种错误发生的概率，决策就是可靠且风险成承受的\n\n如何选取阈值要基于业务场景：\n- 互联网业务下，一般冒然变更风险大于收益，更看重于控制假阳性。最常见的阈值是：假阳性控制在0.05以内，假阴性控制在0.2以内；\n- 生命只有一次，医院检查中更看重控制假阴性。"
  },
  {
    "objectID": "posts/实验统计原理简介/index.html#假阳性如何控制",
    "href": "posts/实验统计原理简介/index.html#假阳性如何控制",
    "title": "实验统计简介",
    "section": "假阳性如何控制",
    "text": "假阳性如何控制\n由于没有效果时期望为0，即\\(E(\\bar{X}_A - \\bar{X}_B) = 0\\)，假阳性是很容易控制的\n假设我们对无效的实验做了100w次，并且根据假阳性0.05选择阈值，模拟可以得到下面的结果：\n\ndef h0_simulation(alpha = 0.05, trans = 0.5, ax=None, std_err = 1):\n    norm_sample = np.random.normal(0, std_err, 1000000)\n    if ax:\n        _, bins, patches = ax.hist(norm_sample, bins=1000, alpha=trans);\n    else:\n        _, bins, patches = plt.hist(norm_sample, bins=1000, alpha=trans);\n    for index, bin in enumerate(bins):\n        if index &gt;= len(patches):\n            break\n        if -np.abs(bin) &lt;= stats.norm.ppf(alpha / 2) * std_err:\n            patches[index].set_facecolor('red')\n        else:\n            patches[index].set_facecolor('blue')\n    return norm_sample\n\nnorm_sample = h0_simulation()\n\n\n\n\n对每个情况计算起随机产生的概率值（pValue），它的分布如下：\n\ndef p_calculator(norm_sample, alpha=0.05):\n    p_values = stats.norm.cdf(-np.abs(norm_sample)) * 2\n    # counts, bins = np.histogram(p_values, bins=100)\n    _, bins, patches = plt.hist(p_values, bins=100,alpha=0.5);\n    for i in range(int(100 * alpha + 1)):\n        patches[i].set_facecolor('red')\n    for i in range(int(100 * alpha + 1), len(patches)):\n        patches[i].set_facecolor('blue')\n    return p_values\n\np_values = p_calculator(norm_sample)\n\n\n\n\n由于实验无效，每次判断都是误判。\n统计我们决策错误的频率，会发现基本等于我们的控制目标0.05。 统计下频率：\n\n(p_values &lt;= 0.05).mean()\n\n0.049946"
  },
  {
    "objectID": "posts/实验统计原理简介/index.html#假阴性控制",
    "href": "posts/实验统计原理简介/index.html#假阴性控制",
    "title": "实验统计简介",
    "section": "假阴性控制",
    "text": "假阴性控制\n假设实验策略有效：\\(\\Delta = E(\\bar{X}_A - \\bar{X}_B)\\) 依据为控制假阳性所选取的阈值，范假阴性错误的几率是多少？\n\nh0_sample = h0_simulation(trans=0.4)\n\ndef h1_simulation(h0_sample, delta = 1, alpha = 0.05, ax=None, std_err=1):\n    h1_sample = h0_sample + delta\n    if ax:\n        _, bins, patches = ax.hist(h1_sample, bins=1000, alpha=0.5);\n    else:\n        _, bins, patches = plt.hist(h1_sample, bins=1000, alpha=0.5);\n    for index, bin in enumerate(bins):\n        if index &gt;= len(patches):\n            break\n        if bin &gt;= stats.norm.ppf(1 - alpha / 2) * std_err:\n            patches[index].set_facecolor('blue')\n        else:\n            patches[index].set_facecolor('red')\n\n    return h1_sample\n\nh1_simulation(h0_sample);\n\n\n\n\n要降低假阴性，我们可以怎么做？ - 尽量增大实验效果，增大两峰之间距离 —— 这与创意质量相关，实验无法影响\n\n_, axs = plt.subplots(1, 2, figsize=(12, 5), sharex=True)\n\nh0_sample = h0_simulation(trans=0.4, ax=axs[0])\nh1_simulation(h0_sample, ax=axs[0]);\n\nh0_sample = h0_simulation(trans=0.4, ax=axs[1])\nh1_simulation(h0_sample, delta=2 ,ax=axs[1]);\n\n\n\n\n\n降低假阳性的要求 —— 有时实验常常取0.1做为阈值\n\n\n_, axs = plt.subplots(1, 2, figsize=(12, 5), sharex=True)\n\nh0_sample = h0_simulation(trans=0.4, ax=axs[0])\nh1_simulation(h0_sample, ax=axs[0]);\n\nh0_sample = h0_simulation(trans=0.4, alpha=0.1, ax=axs[1])\nh1_simulation(h0_sample, alpha=0.1, ax=axs[1]);\n\n\n\n\n\n减少结果波动性（降低标准误），让分布变得更加「高瘦」—— 这是实验可以改善的\n\n\n_, axs = plt.subplots(1, 2, figsize=(12, 5), sharex=True)\n\nh0_sample = h0_simulation(trans=0.4, ax=axs[0])\nh1_simulation(h0_sample, ax=axs[0]);\n\nh0_sample = h0_simulation(trans=0.4, std_err=0.5, ax=axs[1])\nh1_simulation(h0_sample, std_err=0.5, ax=axs[1]);\n\n\n\n\n降低波动是控制检出率的关键。减少波动方法：\n- 增加样本量 —— 最常用方案，通过增加数量减小标准误\n- 处理离群值 —— 减少极值影响，通过降低样本方差减小标准误\n- 降噪算法 —— 控制变量法等"
  },
  {
    "objectID": "posts/实验统计原理简介/index.html#控制假阴性需要多少流量",
    "href": "posts/实验统计原理简介/index.html#控制假阴性需要多少流量",
    "title": "实验统计简介",
    "section": "控制假阴性需要多少流量?",
    "text": "控制假阴性需要多少流量?\n以上可知，假阴性与「真实效果」、「假阳性水平」、「样本方差」、「样本量」等因素相关，那么多大的样本量可以控制假阴性呢？\n\\[样本量 = f(真实效果,假阴性水平,假阳性水平, 流量分配比例, 样本方差)\\]\n其中入参中真实效果是未知的，导致无法直接计算，该如何解决？\n解决方案是引入最小检测效果（Minimum Detectable Effect）。基于此值计算样本量，可保证实验效果大于等于此值时「假阴性」符合标准\n控制假阴性是为了保证检出率，检出率定义为「功效（power）」：\\[功效 = 1 - 假阴性控制水平\\] 分析达到目标功效需要多少流量，称为功效分析\n以双尾等流量实验为例：\n\n定义假阳性控制目标为\\(\\alpha\\)，等流量双尾检验下，控制power需要满足条件： \\[ \\frac{MDE}{\\sqrt{(\\sigma^2 / n + \\sigma^2 / n)}} \\geq \\phi^{-1}(1 - \\alpha / 2) + \\phi^{-1}(power) \\]\n其中\\(\\phi^{-1}\\)是正态分布的逆累积分布函数，由上可推出：\\[n \\geq 2\\sigma ^{2} [ \\phi^{-1} (1 - \\alpha/2) + \\phi^{-1} (power )]^{2}/MDE^2\\]\n以mde = 1, alpha = 0.05, power = 0.8, var = 100计算需要样本量，按此样本量仿真100w次，结果如下：\n\nmde = 1\nalpha = 0.05\npower = 0.8\nvar = 100\n\nn = int(2 * var * (stats.norm.ppf(1 - alpha / 2) + stats.norm.ppf(power)) ** 2 / mde ** 2)\nstd_err = np.sqrt(var / n * 2)\n\nh0_sample = h0_simulation(trans=0.4, std_err=std_err)\nh1_sample = h1_simulation(h0_sample, std_err=std_err)\n\n\n\n\n\np_values = stats.norm.cdf(-np.abs(h1_sample) / std_err) * 2\nN, bins, patches = plt.hist(p_values, bins=100,alpha=0.5);\nfor i in range(11):\n    patches[i].set_facecolor('blue')\nfor i in range(11, len(patches)):\n    patches[i].set_facecolor('red')\n\n\n\n\n统计一下：\n\n(p_values &lt;= 0.05).mean()\n\n0.800003"
  },
  {
    "objectID": "posts/post-with-code/index.html",
    "href": "posts/post-with-code/index.html",
    "title": "Post With Code",
    "section": "",
    "text": "This is a post with executable code."
  },
  {
    "objectID": "posts/welcome/index.html",
    "href": "posts/welcome/index.html",
    "title": "Welcome To My Blog",
    "section": "",
    "text": "This is the first post in a Quarto blog. Welcome!\n\nSince this post doesn’t specify an explicit image, the first image in the post will be used in the listing page of posts."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "rock’s blog",
    "section": "",
    "text": "Post With Code\n\n\n\n\n\n\n\nnews\n\n\ncode\n\n\nanalysis\n\n\n\n\n\n\n\n\n\n\n\nNov 11, 2023\n\n\nHarlow Malloc\n\n\n\n\n\n\n  \n\n\n\n\n实验统计简介\n\n\n\n\n\n\n\nAB\n\n\n\n\n\n\n\n\n\n\n\nNov 11, 2023\n\n\n\n\n\n\n  \n\n\n\n\nWelcome To My Blog\n\n\n\n\n\n\n\nnews\n\n\n\n\n\n\n\n\n\n\n\nNov 8, 2023\n\n\nTristan O’Malley\n\n\n\n\n\n\nNo matching items"
  }
]